class t{static Status={idle:"idle",playing:"playing",win:"win",lose:"lose"};constructor(e=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.status=t.Status.idle,this.initialState=JSON.parse(JSON.stringify(e)),this.state=e,this.score=0,this.rows=4,this.columns=4}hasEmptyTile(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)if(0===this.state[t][e])return!0;return!1}setTwo(){if(!this.hasEmptyTile())return;let t=!1;for(;!t;){let e=Math.floor(Math.random()*this.rows),s=Math.floor(Math.random()*this.columns);0===this.state[e][s]&&(this.state[e][s]=Math.random()>=.9?4:2,t=!0)}this.updateTiles()}filterZero(t){return t.filter(t=>0!==t)}slide(t){let e=this.filterZero(t);for(let t=0;t<e.length;t++)e[t]===e[t+1]&&(e[t]+=e[t+1],e[t+1]=0,this.score+=e[t]);for(e=this.filterZero(e);e.length<4;)e.push(0);return e}updateState(t){this.state=t,this.updateTiles(),this.setTwo()}updateTiles(){let t=document.querySelectorAll(".field-row");for(let e=0;e<t.length;e++){let s=t[e].querySelectorAll(".field-cell");for(let t=0;t<s.length;t++){let i=this.state[e][t];s[t].classList="field-cell",s[t].innerHTML="",i>0&&(s[t].classList.add(`field-cell--${i}`),s[t].innerHTML=i)}}this.checkGameOver(),this.checkGameWin()}canMove(t){return t.some(t=>t.includes(0))}checkUpdate(t){return JSON.stringify(this.state)!==JSON.stringify(t)}checkGameWin(){this.state.flat().some(e=>{2048===e&&(this.status=t.Status.win)})}checkGameOver(){if(!this.hasEmptyTile()){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)if(t<3&&this.state[t][e]===this.state[t+1][e]||e<3&&this.state[t][e]===this.state[t][e+1])return;this.status=t.Status.lose}}moveLeft(){if(this.getStatus()!==t.Status.playing&&this.getStatus()!==t.Status.win)return;let e=this.getState().map(t=>this.slide(t));this.checkUpdate(e)&&this.updateState(e)}moveRight(){if(this.getStatus()!==t.Status.playing&&this.getStatus()!==t.Status.win)return;let e=this.getState().map(t=>this.slide([...t].reverse())).map(t=>t.reverse());this.checkUpdate(e)&&this.updateState(e)}moveUp(){if(this.getStatus()!==t.Status.playing&&this.getStatus()!==t.Status.win)return;let e=[...this.state.map(t=>[...t])];for(let t=0;t<this.columns;t++){let s=[this.state[0][t],this.state[1][t],this.state[2][t],this.state[3][t]];s=this.slide(s);for(let i=0;i<this.rows;i++)e[i][t]=s[i]}(this.canMove(this.state.slice(0,3))||this.checkUpdate(e))&&this.updateState(e)}moveDown(){if(this.getStatus()!==t.Status.playing&&this.getStatus()!==t.Status.win)return;let e=[...this.state.map(t=>[...t])];for(let t=0;t<this.columns;t++){let s=[this.state[0][t],this.state[1][t],this.state[2][t],this.state[3][t]];(s=this.slide(s.reverse())).reverse();for(let i=0;i<this.rows;i++)e[i][t]=s[i]}(this.canMove(this.state.slice(1))||this.checkUpdate(e))&&this.updateState(e)}getScore(){return this.score}getState(){return this.state}getStatus(){return this.status}start(){this.status=t.Status.playing,this.setTwo(),this.setTwo()}restart(){this.status=t.Status.idle,this.state=JSON.parse(JSON.stringify(this.initialState)),this.score=0,this.updateTiles()}}const e=new t([[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]),s=document.querySelector(".start"),i=document.querySelector(".game-score"),a=document.querySelector(".message-start"),r=document.querySelector(".message-win"),h=document.querySelector(".message-lose");function l(){let t=e.getStatus();"playing"===t?a.classList.add("hidden"):"win"===t?r.classList.remove("hidden"):"lose"===t?h.classList.remove("hidden"):"idle"===t&&(a.classList.remove("hidden"),r.classList.add("hidden"),h.classList.add("hidden"))}s.addEventListener("click",t=>{s.classList.contains("start")?(e.start(),s.classList.replace("start","restart"),s.textContent="Restart"):(e.restart(),s.classList.replace("restart","start"),s.textContent="Start",i.textContent=0),l()}),document.addEventListener("keyup",t=>{if("playing"===e.getStatus()||"win"===e.getStatus()){switch(t.code){case"ArrowRight":e.moveRight();break;case"ArrowLeft":e.moveLeft();break;case"ArrowUp":e.moveUp();break;case"ArrowDown":e.moveDown()}i.textContent=e.getScore(),l()}});
//# sourceMappingURL=index.bf259cc4.js.map
